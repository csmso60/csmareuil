<script>
document.getElementById("anomalie-form").addEventListener("submit", function(e) {
  e.preventDefault();

  const nom = document.getElementById("nom").value;
  const anomalie = document.getElementById("anomalie").value;
  const photoInput = document.getElementById("photo");

  const formData = new FormData();
  formData.append("nom", nom);
  formData.append("anomalie", anomalie);

  if (photoInput.files.length > 0) {
    const file = photoInput.files[0];
    const reader = new FileReader();

    reader.onload = function() {
      formData.append("photoBase64", reader.result);
      formData.append("photoName", file.name);
      sendForm(formData);
    };

    reader.readAsDataURL(file);
  } else {
    sendForm(formData);
  }
});

function sendForm(formData) {
  fetch("https://script.google.com/macros/s/AKfycbxxJh4CO8_wCOXsWDk4XOshGQuUXXQbMuIZETwXmxiulmCm_xzkH2WK25jPfjP1Tv-O/exec", {
    method: "POST",
    body: formData
  })
  .then(() => {
    alert("Merci, votre anomalie a bien été transmise.");
    document.getElementById("anomalie-form").reset();
  })
  .catch(() => {
    alert("Erreur lors de l’envoi.");
  });
}
</script>

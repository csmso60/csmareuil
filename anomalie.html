<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Déclaration d’anomalie</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>Déclaration d’anomalie</h1>

<form id="anomalie-form">
  <label>Nom / Prénom</label>
  <input type="text" id="nom" required>

  <label>Description de l’anomalie</label>
  <textarea id="anomalie" required></textarea>

  <label>Photo (facultatif)</label>
  <input type="file" id="photo" accept="image/*">

  <button type="submit">Envoyer</button>
</form>

<script>
document.getElementById("anomalie-form").addEventListener("submit", function(e) {
  e.preventDefault();

  const nom = document.getElementById("nom").value;
  const anomalie = document.getElementById("anomalie").value;
  const photoInput = document.getElementById("photo");

  const formData = new FormData();
  formData.append("nom", nom);
  formData.append("anomalie", anomalie);

  if (photoInput.files.length > 0) {
    const file = photoInput.files[0];
    const reader = new FileReader();

    reader.onload = function() {
      formData.append("photoBase64", reader.result);
      formData.append("photoName", file.name);
      envoyer(formData);
    };

    reader.readAsDataURL(file);
  } else {
    envoyer(formData);
  }
});

function envoyer(formData) {
  fetch("https://script.google.com/macros/s/AKfycbxxJh4CO8_wCOXsWDk4XOshGQuUXXQbMuIZETwXmxiulmCm_xzkH2WK25jPfjP1Tv-O/exec", {
    method: "POST",
    body: formData
  })
  .then(() => {
    alert("Merci, votre anomalie a bien été transmise.");
    document.getElementById("anomalie-form").reset();
  })
  .catch(err => {
    console.error(err);
    alert("Erreur lors de l’envoi de l’anomalie.");
  });
}
</script>

</body>
</html>
